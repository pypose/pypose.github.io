


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pypose.module.mppi &mdash; PyPose main documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <!-- <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" /> -->
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/katex-math.css" type="text/css" />
    <link rel="index" title="Index" href="../../../../genindex/" />
    <link rel="search" title="Search" href="../../../../search/" />

<!--
  Search engines should not index the master version of documentation.
  Stable documentation are built without release == 'main'.
-->
<meta name="robots" content="noindex">


  <!-- Google Analytics -->
  
  <!-- End Google Analytics -->
  


  
  <script src="../../../../_static/js/modernizr.min.js"></script>

  <!-- Preload the theme fonts -->

<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-book.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-Medium.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/FreightSans/freight-sans-medium-italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="../../../../_static/fonts/IBMPlexMono/IBMPlexMono-SemiBold.woff2" as="font" type="font/woff2" crossorigin="anonymous">

<!-- Preload the katex fonts -->

<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Math-Italic.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Main-Bold.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size1-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size4-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size2-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Size3-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/fonts/KaTeX_Caligraphic-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css" integrity="sha384-vSIIfh2YWi9wW0r9iZe7RJPrKwp6bG+s9QZMoITbCckVJqGCCRhc+ccxNcdpHuYu" crossorigin="anonymous">
</head>

<div class="container-fluid header-holder tutorials-header" id="header-holder">
  <div class="container">
    <div class="header-container">
      <a class="header-logo" href="https://pypose.org/" aria-label="PyTorch"></a>

      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pypose.org/get-started">Get Started</a>
          </li>

          <!-- <li> -->
          <li>
            <a href="https://pypose.org/tutorials">Tutorials</a>
          </li>

          <!-- <li class="active docs-active"> -->
          <li>
            <a href="https://pypose.org/docs/main/index.html">Doc</a>
          </li>

          <li>
            <a href="https://pypose.org/about-us">About Us</a>
          </li>

          <li>
            <a href="https://github.com/pypose/pypose">GitHub</a>
          </li>
        </ul>
      </div>

      <a class="main-menu-open-button" href="#" data-behavior="open-mobile-menu"></a>
    </div>
  </div>
</div>

<body class="pytorch-body">

   

    

    <div class="table-of-contents-link-wrapper">
      <span>Table of Contents</span>
      <a href="#" class="toggle-table-of-contents" data-behavior="toggle-table-of-contents"></a>
    </div>

    <nav data-toggle="wy-nav-shift" class="pytorch-left-menu" id="pytorch-left-menu">
      <div class="pytorch-side-scroll">
        <div class="pytorch-menu pytorch-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          <div class="pytorch-left-menu-search">
            
    <div class="version">
      <a href='https://pypose.org/docs/versions.html'>0.6.4 &#x25BC</a>
    </div>
    


  


<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search/" method="get">
    <input type="text" name="q" placeholder="Search Docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          </div>

          

<div>
  <a style="color:#F05732" href="_modules/pypose/module/mppi.html">
    You are viewing unstable developer preview docs.
    Click here to view docs for latest stable release.
  </a>
</div>


            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../func/">Func</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../functions/">Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../convert/">Convert</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../modules/">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../optim/">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../utils/">Utils</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../testing/">Testing</a></li>
</ul>

            
          

        </div>
      </div>
    </nav>

    <div class="pytorch-container">
      <div class="pytorch-page-level-bar" id="pytorch-page-level-bar">
        <div class="pytorch-breadcrumbs-wrapper">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="pytorch-breadcrumbs">
    
      <li>
        <a href="../../../../">
          
            Docs
          
        </a> &gt;
      </li>

        
          <li><a href="../../../">Module code</a> &gt;</li>
        
      <li>pypose.module.mppi</li>
    
    
      <li class="pytorch-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
</div>
        </div>

        <div class="pytorch-shortcuts-wrapper" id="pytorch-shortcuts-wrapper">
          Shortcuts
        </div>
      </div>

      <section data-toggle="wy-nav-shift" id="pytorch-content-wrap" class="pytorch-content-wrap">
        <div class="pytorch-content-left">

        
          
          <div class="rst-content">
          
            <div role="main" class="main-content" itemscope="itemscope" itemtype="http://schema.org/Article">
             <article itemprop="articleBody" id="pytorch-article" class="pytorch-article">
              
  <h1>Source code for pypose.module.mppi</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.distributions.multivariate_normal</span> <span class="kn">import</span> <span class="n">MultivariateNormal</span>



<div class="viewcode-block" id="MPPI"><a class="viewcode-back" href="../../../../generated/pypose.module.MPPI/#pypose.module.MPPI">[docs]</a><span class="k">class</span> <span class="nc">MPPI</span><span class="p">():</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Model Predictive Path Integral Control (MPPI).</span>

<span class="sd">    Args:</span>
<span class="sd">        dynamics (:obj:`callable`): Function(state, action) -&gt; next_state. The dynamics</span>
<span class="sd">            model of the system.</span>
<span class="sd">        running_cost (:obj:`callable`): Function to compute the cost for a given state and</span>
<span class="sd">            action.</span>
<span class="sd">        nx (:obj:`int`): Dimension of the state space.</span>
<span class="sd">        noise_sigma (:obj:`Tensor`): Covariance matrix for control noise.</span>
<span class="sd">        num_samples (:obj:`int`): Number of trajectories to sample.</span>
<span class="sd">        horizon (:obj:`int`): Length of each trajectory.</span>
<span class="sd">        device (:obj:`str`): PyTorch device for computation.</span>
<span class="sd">        noise_mu (:obj:`Tensor`, optional): Mean of the control noise distribution.</span>
<span class="sd">            Defaults to a tensor of zeros.</span>
<span class="sd">        lambda_ (:obj:`float`, optional): Temperature parameter that affects the balance</span>
<span class="sd">            between cost and exploration. Higher values favor exploration.</span>
<span class="sd">        u_min (:obj:`Tensor`, optional): Lower bounds for control actions. Defaults to</span>
<span class="sd">            negative infinity.</span>
<span class="sd">        u_max (:obj:`Tensor`, optional): Upper bounds for control actions. Defaults to</span>
<span class="sd">            positive infinity.</span>
<span class="sd">        noise_abs_cost (:obj:`float`, optional): Absolute cost of the noise, aiding in</span>
<span class="sd">            control noise evaluation. Defaults to zero.</span>

<span class="sd">    **Model Predictive Path Integral Control** is an advanced form of Nonlinear Model</span>
<span class="sd">    Predictive Control (NMPC) that efficiently solves finite-horizon optimal control</span>
<span class="sd">    tasks under nonlinear dynamics and complex cost functions. It leverages the</span>
<span class="sd">    parallel computing power of GPUs to sample multiple trajectories in real-time,</span>
<span class="sd">    optimizing control actions based on a weighted average of the sampled costs.</span>

<span class="sd">    The operation of MPPI can be described with the following optimization problem,</span>
<span class="sd">    aiming to minimize the expected value of the cost function over a prediction</span>
<span class="sd">    horizon :math:`N`:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \begin{align*}</span>
<span class="sd">            \min_{\mathbf{U}} J (\mathbf{U}) &amp;= \mathbb{E} \left[ \sum_{k=0}^{N-1}</span>
<span class="sd">                \left(q_k(\mathbf{x}_k, \mathbf{u}_k) +</span>
<span class="sd">                \frac{1}{2}\mathbf{u}_k^\top\mathbf{R}\mathbf{u}_k\right) +</span>
<span class="sd">                \phi(\mathbf{x}_N)\right] \\</span>
<span class="sd">            \text{subject to} \quad</span>
<span class="sd">            &amp;\mathbf{x}_{k+1} = F(\mathbf{x}_k, \mathbf{u}_k + \bm{\epsilon}_k) \\</span>
<span class="sd">            &amp;\mathbf{X}(0) = \mathbf{x}_0, \quad \bm{\epsilon}_k \sim</span>
<span class="sd">                \mathcal{N} (0, \bm{\Sigma}_{\epsilon})</span>
<span class="sd">        \end{align*}</span>

<span class="sd">    Here, :math:`J` is the objective function, :math:`\mathbb{E}` denotes the expected</span>
<span class="sd">    value, and :math:`\epsilon` represents the control noise modeled by the</span>
<span class="sd">    Ornstein-Uhlenbeck process. MPPI samples :math:`M` trajectories, computes the cost</span>
<span class="sd">    for each, and calculates the optimal control as a weighted average of these costs:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \begin{equation*}</span>
<span class="sd">            \mathbf{U} = \sum_{j = 1}^M w_j\mathbf{U}^{(j)}/\sum_{j = 1}^{M} w_j</span>
<span class="sd">        \end{equation*}</span>

<span class="sd">    Weights :math:`w_j` for each sample are computed as:</span>

<span class="sd">    .. math::</span>
<span class="sd">        \begin{equation*}</span>
<span class="sd">            w_j = \exp\left(-\frac{1}{\lambda}(S_j - \beta)\right)</span>
<span class="sd">        \end{equation*}</span>

<span class="sd">    where :math:`\beta = \min_{j=1,\cdots, M} S_j`, and :math:`\lambda` influences</span>
<span class="sd">    the selectiveness of the weighted average.</span>

<span class="sd">    Note:</span>
<span class="sd">        MPPI is based on the algorithm from:</span>

<span class="sd">        - Williams, G., et al., &#39;Information Theoretic MPC for Model-Based</span>
<span class="sd">          Reinforcement Learning&#39;, 2017.</span>
<span class="sd">        - Implementations adapted from GitHub repositories for pytorch_mppi</span>
<span class="sd">          and mppi_pendulum.</span>


<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; import torch</span>
<span class="sd">        &gt;&gt;&gt; import pypose as pp</span>
<span class="sd">        &gt;&gt;&gt; class Simple2DNav(pp.module.System):</span>
<span class="sd">        ...     def __init__(self,dt,length=1.0):</span>
<span class="sd">        ...         super().__init__()</span>
<span class="sd">        ...         self._tau = dt</span>
<span class="sd">        ...         self._length=length</span>
<span class="sd">        ...</span>
<span class="sd">        ...     def state_transition(self, state, input, t=None):</span>
<span class="sd">        ...         x, y, theta = state.moveaxis(-1, 0)</span>
<span class="sd">        ...         v, omega = input.squeeze().moveaxis(-1, 0)</span>
<span class="sd">        ...         xDot = v * torch.cos(theta)</span>
<span class="sd">        ...         yDot = v * torch.sin(theta)</span>
<span class="sd">        ...         thetaDot = omega</span>
<span class="sd">        ...         _dstate = torch.stack((xDot, yDot, thetaDot), dim=-1)</span>
<span class="sd">        ...         return (state.squeeze() + torch.mul(_dstate, self._tau)).unsqueeze(0)</span>
<span class="sd">        ...</span>
<span class="sd">        ...     def observation(self, state, input, t=None):</span>
<span class="sd">        ...         return state</span>
<span class="sd">        ...</span>
<span class="sd">        &gt;&gt;&gt; torch.manual_seed(0)</span>
<span class="sd">        &gt;&gt;&gt; x0 = torch.tensor([0., 0., 0.], requires_grad=False)</span>
<span class="sd">        &gt;&gt;&gt; dt = 0.1</span>
<span class="sd">        &gt;&gt;&gt; cost_fn = lambda x, u, t: (x[..., 0] - 10)**2 + (x[..., 1] - 10)**2 \</span>
<span class="sd">        &gt;&gt;&gt; + (u[..., 0])**2</span>
<span class="sd">        &gt;&gt;&gt; mppi = MPPI(</span>
<span class="sd">        &gt;&gt;&gt;     dynamics=Simple2DNav(dt),</span>
<span class="sd">        &gt;&gt;&gt;     running_cost=cost_fn,</span>
<span class="sd">        &gt;&gt;&gt;     nx=3,</span>
<span class="sd">        &gt;&gt;&gt;     noise_sigma=torch.eye(2) * 1,</span>
<span class="sd">        &gt;&gt;&gt;     num_samples=100,</span>
<span class="sd">        &gt;&gt;&gt;     horizon=5,</span>
<span class="sd">        &gt;&gt;&gt;     lambda_=0.01</span>
<span class="sd">        &gt;&gt;&gt;     )</span>
<span class="sd">        &gt;&gt;&gt; u, xn= pp.mppi.forward(x0)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;u = &#39;, u)</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;x = &#39;, xn)</span>
<span class="sd">        u =  tensor([[-1.0977,  0.6999],</span>
<span class="sd">                        [ 0.4890, -0.6172],</span>
<span class="sd">                        [ 1.3908, -0.6498],</span>
<span class="sd">                        [-0.1326, -0.2450],</span>
<span class="sd">                        [ 0.6668, -0.9944]])</span>
<span class="sd">        x =  tensor([[ 0.0000e+00,  0.0000e+00,  0.0000e+00],</span>
<span class="sd">                        [-1.0977e-01,  0.0000e+00,  6.9991e-02],</span>
<span class="sd">                        [-6.0990e-02,  3.4199e-03,  8.2744e-03],</span>
<span class="sd">                        [ 7.8084e-02,  4.5706e-03, -5.6704e-02],</span>
<span class="sd">                        [ 6.4848e-02,  5.3220e-03, -8.1209e-02],</span>
<span class="sd">                        [ 1.3131e-01, -8.6915e-05, -1.8065e-01]])</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">dynamics</span><span class="p">,</span>
                 <span class="n">running_cost</span><span class="p">,</span>
                 <span class="n">nx</span><span class="p">,</span>
                 <span class="n">noise_sigma</span><span class="p">,</span>
                 <span class="n">num_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">horizon</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span>
                 <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span>
                 <span class="n">lambda_</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span>
                 <span class="n">noise_mu</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">u_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">u_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">noise_abs_cost</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span>
                 <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">noise_sigma</span><span class="o">.</span><span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">K</span> <span class="o">=</span> <span class="n">num_samples</span>  <span class="c1"># N_SAMPLES</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">horizon</span>  <span class="c1"># TIMESTEPS</span>
        <span class="c1"># dimensions of state and control</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nx</span> <span class="o">=</span> <span class="n">nx</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">noise_sigma</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">noise_sigma</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">=</span> <span class="n">lambda_</span>
        <span class="k">if</span> <span class="n">noise_mu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">noise_mu</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="c1"># handle 1D edge case</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">noise_mu</span> <span class="o">=</span> <span class="n">noise_mu</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">noise_sigma</span> <span class="o">=</span> <span class="n">noise_sigma</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">u_max</span> <span class="o">=</span> <span class="n">u_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">u_min</span> <span class="o">=</span> <span class="n">u_min</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_max</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_max</span><span class="p">)</span> \
                <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_max</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_max</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_min</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">u_max</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_min</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_min</span><span class="p">)</span> \
                <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u_min</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_min</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_max</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">u_min</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_min</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_min</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">u_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_max</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise_mu</span> <span class="o">=</span> <span class="n">noise_mu</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise_sigma</span> <span class="o">=</span> <span class="n">noise_sigma</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise_sigma_inv</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_sigma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise_dist</span> <span class="o">=</span> <span class="n">MultivariateNormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_mu</span><span class="p">,</span> \
            <span class="n">covariance_matrix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_sigma</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system</span> <span class="o">=</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">state_transition</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running_cost</span> <span class="o">=</span> <span class="n">running_cost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">noise_abs_cost</span> <span class="o">=</span> <span class="n">noise_abs_cost</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># sampled results from last command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost_total</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost_total_non_zero</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">states</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>



<div class="viewcode-block" id="MPPI.forward"><a class="viewcode-back" href="../../../../generated/pypose.module.MPPI/#pypose.module.MPPI.forward">[docs]</a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">u_init</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Executes the MPPI control loop for a given initial state and optional initial control input.</span>

<span class="sd">            Args:</span>
<span class="sd">                state (:obj:`Tensor`): The initial state of the system.</span>
<span class="sd">                u_init (:obj:`Tensor`, optional): Initial guess for the control inputs. Defaults to None.</span>

<span class="sd">            Returns:</span>
<span class="sd">                :obj:`Tensor`: The optimal control sequence over the time horizon.</span>
<span class="sd">                :obj:`Tensor`: The sequence of states resulting from applying the optimal control sequence.</span>


<span class="sd">            The MPPI controller generates a base control sequence and then samples multiple perturbations around this sequence using the specified noise distribution. Constraints on control inputs are enforced, and the costs associated with each trajectory are evaluated to compute a weighted average of the perturbed controls, forming the final optimal control sequence.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> \
            <span class="k">if</span> <span class="ow">not</span> <span class="n">torch</span><span class="o">.</span><span class="n">is_tensor</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">else</span> <span class="n">state</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="n">u_init</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">noise_mu</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> \
            <span class="k">if</span> <span class="n">u_init</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">u_init</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>


        <span class="n">U_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,))</span>
        <span class="n">U_base</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">U_base</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">U_base</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_init</span>

        <span class="n">noise</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">K</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
        <span class="n">perturbed_action</span> <span class="o">=</span> <span class="n">U_base</span> <span class="o">+</span> <span class="n">noise</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_max</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
                <span class="n">u</span> <span class="o">=</span> <span class="n">perturbed_action</span><span class="p">[:,</span> <span class="nb">slice</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)]</span>
                <span class="n">cu</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_max</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">u_min</span><span class="p">)</span>
                <span class="n">perturbed_action</span><span class="p">[:,</span> <span class="nb">slice</span><span class="p">(</span><span class="n">t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="p">)]</span> <span class="o">=</span> <span class="n">cu</span>

        <span class="n">noise</span> <span class="o">=</span> <span class="n">perturbed_action</span> <span class="o">-</span> <span class="n">U_base</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_abs_cost</span><span class="p">:</span>
            <span class="n">action_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">*</span> <span class="n">torch</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">noise</span><span class="p">)</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_sigma_inv</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">action_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span> <span class="o">*</span> <span class="n">noise</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">noise_sigma_inv</span>

        <span class="n">K</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span> <span class="n">perturbed_action</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">assert</span> <span class="n">nu</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span>
        <span class="n">cost_total_temp</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">cost_samples</span> <span class="o">=</span> <span class="n">cost_total_temp</span>
        <span class="n">states_temp</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">actions_temp</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Repeat the initial state to match the batch size</span>
        <span class="n">state_temp</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">K</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">perturbed_action</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span>
            <span class="c1">#import pdb; pdb.set_trace()</span>
            <span class="n">state_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">state_temp</span><span class="p">,</span> <span class="n">u</span><span class="p">)</span>
            <span class="c1">#import pdb; pdb.set_trace()</span>
            <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">running_cost</span><span class="p">(</span><span class="n">state_temp</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
            <span class="n">cost_samples</span> <span class="o">=</span> <span class="n">cost_samples</span> <span class="o">+</span> <span class="n">c</span>
            <span class="n">states_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">state_temp</span><span class="p">)</span>
            <span class="n">actions_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

        <span class="n">cost_total_temp</span> <span class="o">=</span> <span class="n">cost_total_temp</span> <span class="o">+</span> <span class="n">cost_samples</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cost_total</span> <span class="o">=</span> <span class="n">cost_total_temp</span>

        <span class="c1"># Action perturbation cost</span>
        <span class="n">perturbation_cost</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">U_base</span> <span class="o">*</span> <span class="n">action_cost</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">cost_total</span> <span class="o">=</span> <span class="n">cost_total</span> <span class="o">+</span> <span class="n">perturbation_cost</span>

        <span class="n">beta</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">cost_total</span><span class="p">)</span>
        <span class="n">cost_total_non_zero</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cost_total</span> <span class="o">-</span> <span class="n">beta</span><span class="p">))</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cost_total_non_zero</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">omega</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="n">cost_total_non_zero</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
            <span class="n">U_base</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">U_base</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> \
                <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">omega</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">noise</span><span class="p">[:,</span> <span class="n">t</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


        <span class="n">action2states</span> <span class="o">=</span> <span class="p">[</span><span class="n">state</span><span class="p">]</span>
        <span class="c1"># Start with initial state in a list</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
            <span class="n">cur_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">action2states</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">U_base</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">action2states</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cur_state</span><span class="o">.</span><span class="n">squeeze</span><span class="p">())</span>

        <span class="c1"># Convert list of tensors to a single tensor</span>
        <span class="n">action2states</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">action2states</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">U_base</span><span class="p">,</span> <span class="n">action2states</span></div></div>
</pre></div>

             </article>
             
            </div>
            <footer>
  

  

    <hr>

  

  <div role="contentinfo">
    <p>
        &copy; Copyright 2022, PyPose Contributors.

    </p>
  </div>
    
      <div>
        Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
      </div>
     

</footer>

          </div>
        </div>

        <div class="pytorch-content-right" id="pytorch-content-right">
          <div class="pytorch-right-menu" id="pytorch-right-menu">
            <a class="twitter-timeline" data-chrome="noborders" href="https://twitter.com/pypose_org?ref_src=twsrc%5Etfw">Tweets by pypose_org<br>You need VPN if you see this.</a> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
          </div>
        </div>
      </section>
    </div>

  


  

     
       <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
         <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
         <script src="../../../../_static/jquery.js"></script>
         <script src="../../../../_static/underscore.js"></script>
         <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
         <script src="../../../../_static/doctools.js"></script>
         <script src="../../../../_static/katex.min.js"></script>
         <script src="../../../../_static/auto-render.min.js"></script>
         <script src="../../../../_static/katex_autorenderer.js"></script>
     

  

  <script type="text/javascript" src="../../../../_static/js/vendor/popper.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/vendor/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
  <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
 
<script script type="text/javascript">
  var collapsedSections = ['Developer Notes', 'Language Bindings', 'Libraries', 'Community'];
</script>

<img height="1" width="1" style="border-style:none;" alt="" src="https://www.googleadservices.com/pagead/conversion/795629140/?label=txkmCPmdtosBENSssfsC&amp;guid=ON&amp;script=0"/>


  <!-- Begin Footer -->

  <div class="container-fluid docs-tutorials-resources" id="docs-tutorials-resources">
    <div class="container">
      <div class="row">
        <div class="col-md-4 text-center">
          <h2>Docs</h2>
          <p>Access documentation for PyPose</p>
          <a class="with-right-arrow" href="https://pypose.org/docs/main/index.html">View Docs</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Tutorials</h2>
          <p>Get started with tutorials and examples</p>
          <a class="with-right-arrow" href="https://pypose.org/tutorials">View Tutorials</a>
        </div>

        <div class="col-md-4 text-center">
          <h2>Get Started</h2>
          <p>Find resources and how to start using pypose</p>
          <a class="with-right-arrow" href="https://pypose.org/resources">View Resources</a>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <div class="container footer-container">
      <div class="footer-logo-wrapper">
        <a href="https://pypose.org/" class="footer-logo"></a>
      </div>

      <div class="footer-links-wrapper">
        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pypose.org/">Pypose</a></li>
            <li><a href="https://pypose.org/get-started">Get Started</a></li>
            <li><a href="https://pypose.org/features">Features</a></li>
            <li><a href="https://github.com/pypose/pypose/blob/main/CONTRIBUTING.md">Contributing</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title"><a href="https://pypose.org/resources">Resources</a></li>
            <li><a href="https://pypose.org/tutorials">Tutorials</a></li>
            <li><a href="https://pypose.org/docs/main/index.html">Docs</a></li>
            <li><a href="https://github.com/pypose/pypose/issues" target="_blank">Github Issues</a></li>
          </ul>
        </div>

        <div class="footer-links-col">
          <ul>
            <li class="list-title">Stay up to date</li>
            <li><a href="https://twitter.com/pypose_org" target="_blank">Twitter</a></li>
            <li><a href="https://github.com/pypose/pypose" target="_blank">GitHub</a></li>

          </ul>  
          </div>
        </div>
     </div>

  </footer>

  <div class="cookie-banner-wrapper">
  <div class="container">
    <p class="gdpr-notice">To analyze traffic and optimize your experience, we serve cookies on this site. By clicking or navigating, you agree to allow our usage of cookies. As the current maintainers of this site, Facebook’s Cookies Policy applies. Learn more, including about available controls: <a href="https://www.facebook.com/policies/cookies/">Cookies Policy</a>.</p>
    <img class="close-button" src="../../../../_static/images/pytorch-x.svg">
  </div>
</div>

  <!-- End Footer -->

  <!-- Begin Mobile Menu -->

  <div class="mobile-main-menu">
    <div class="container-fluid">
      <div class="container">
        <div class="mobile-main-menu-header-container">
          <a class="header-logo" href="https://pypose.org/" aria-label="PyTorch"></a>
          <a class="main-menu-close-button" href="#" data-behavior="close-mobile-menu"></a>
        </div>
      </div>
    </div>

    <div class="mobile-main-menu-links-container">
      <div class="main-menu">
        <ul>
          <li>
            <a href="https://pypose.org/get-started">Get Started</a>
          </li>
          <li>
            <a href="https://pypose.org/tutorials">Tutorials</a>
          </li>
          <li>
            <a href="https://pypose.org/docs/main/index.html">Docs</a>
          </li>
          <li>
            <a href="https://pypose.org/about-us">About Us</a>
          </li>
          <li>
            <a href="https://github.com/pypose/pypose">Github</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- End Mobile Menu -->

  <script type="text/javascript" src="../../../../_static/js/vendor/anchor.min.js"></script>

  <script type="text/javascript">
    $(document).ready(function() {
      mobileMenu.bind();
      mobileTOC.bind();
      pytorchAnchors.bind();
      sideMenus.bind();
      scrollToAnchor.bind();
      highlightNavigation.bind();
      mainMenuDropdown.bind();
      filterTags.bind();

      // Add class to links that have code blocks, since we cannot create links in code blocks
      $("article.pytorch-article a span.pre").each(function(e) {
        $(this).closest("a").addClass("has-code");
      });
    })
  </script>
</body>
</html>